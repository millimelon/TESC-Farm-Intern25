import{d as W,e as n,f as G,h as S,i as H,j as Q,k as D,o as h,c as t,l as N,w as o,n as V,q as s,F as A,s as X,b as B,t as E,v as x,x as y,y as F,z as Y}from"./index-Dh_AapEK.js";import{f as _,V as P,a as b,b as Z,c as ee,d as ae,e as le,g as te,h as se,i as oe,j as ne}from"./VSwitch-Bu4A_GEz.js";import{V as K,a as re,b as ue}from"./VContainer-gnB-RFH2.js";import"./tag-C_XtA0t5.js";import"./ssrBoot-KIuo4xy3.js";const ce={key:0,id:"anumfloat",class:"align-self-end"},ge=W({__name:"index",setup(ie){console.log("https://api.tesc.farm");const C=n(!1),T=n(!1),p=n([]),g=n(""),c=n(""),r=n(0),i=n("mdi-form-textbox"),u=n(!1),d=n("success"),f=n(""),m=n({}),v=n({}),O=G("anum"),R=S(()=>{const l=new Set;for(const e of Array.from(m.value))for(const a of e.tags)l.add(a.name);return Array.from(l)}),$=S(()=>{let l=Array.from(m.value);return T.value?l.sort((e,a)=>e.name.localeCompare(a.name)):(l=l.filter(e=>_.includes(e.ID)),l.sort((e,a)=>_.indexOf(e.ID)-_.indexOf(a.ID))),p.value.length>0&&(l=l.filter(e=>e.tags.some(a=>p.value.includes(a.name)))),g.value&&(l=l.filter(e=>(e.name+e.description).toUpperCase().includes(g.value.toUpperCase()))),l}),z=S(()=>r.value==0?"None":r.value<0?"Stop Tracking Time":m.value.find(l=>l.ID===r.value).name),I=l=>{r.value=l,l!=0&&Y(()=>{var e;(e=O.value)==null||e.focus()})},J=async()=>{C.value=!0;try{const l=await fetch("https://api.tesc.farm/tasks");l.ok||console.log(l.status),m.value=await l.json(),m.value.forEach(e=>{v.value[e.ID]=0})}catch(l){console.log(l)}finally{w()}},w=async()=>{C.value=!0;try{const l=await fetch("https://api.tesc.farm/hours/working");l.ok||console.log(l.status),m.value.forEach(a=>{v.value[a.ID]=0}),(await l.json()).forEach(a=>{v.value[a.task_id]++})}catch(l){console.log(l)}finally{C.value=!1}},U=()=>{c.value!=""&&(r.value==-1?M(c.value):L(c.value,r.value),c.value="")},q=l=>{c.value.length>8&&(U(),l.target.focus())},L=async(l,e)=>{const a={barcode:l,task:e};try{const k=await fetch("https://api.tesc.farm/hours/punch",{method:"POST",credentials:"include",body:JSON.stringify(a)});k.ok?(f.value="Tracking Time!",d.value="success",u.value=!0,i.value="mdi-check-circle"):(f.value=k.statusText,d.value="error",u.value=!0,i.value="mdi-alert-circle")}catch(k){f.value=k,d.value="error",u.value=!0}finally{setTimeout(()=>{i.value="mdi-form-textbox"},3e3),w()}},M=async l=>{const e={barcode:l};try{const a=await fetch("https://api.tesc.farm/hours/punch",{method:"POST",credentials:"include",body:JSON.stringify(e)});a.ok?(f.value="Stopped Tracking Time!",d.value="success",u.value=!0,i.value="mdi-check-circle"):(f.value=a.statusText,d.value="error",u.value=!0,i.value="mdi-alert-circle")}catch(a){f.value=a,d.value="error",u.value=!0}finally{setTimeout(()=>{i.value="mdi-form-textbox"},3e3),w()}};let j;return H(()=>{J(),j=setInterval(w,6e4)}),Q(()=>{clearInterval(j)}),(l,e)=>(h(),D(A,null,[t(ue,{fluid:"",id:"taskpanel",class:"fill-height d-flex flex-column withfloat"},{default:o(()=>[t(P,{id:"filters",class:"align-self-start d-flex w-100"},{default:o(()=>[t(b,{cols:"12",sm:"4",md:"8"},{default:o(()=>[t(K,{id:"search",modelValue:s(g),"onUpdate:modelValue":e[0]||(e[0]=a=>V(g)?g.value=a:null),clearable:"",label:"Search",hint:"Search for tasks by name or description"},null,8,["modelValue"])]),_:1}),t(b,{cols:"6",sm:"4",md:"2"},{default:o(()=>[t(Z,{clearable:"",chips:"",multiple:"",label:"Tags",modelValue:s(p),"onUpdate:modelValue":e[1]||(e[1]=a=>V(p)?p.value=a:null),items:s(R)},null,8,["modelValue","items"])]),_:1}),t(b,{cols:"6",sm:"4",md:"2",class:"d-flex align-self-start"},{default:o(()=>[t(ee,{label:"Show All",inset:"",color:"secondary",modelValue:s(T),"onUpdate:modelValue":e[2]||(e[2]=a=>V(T)?T.value=a:null)},null,8,["modelValue"])]),_:1})]),_:1}),t(P,{align:"center",justify:"center",class:"d-flex flex-row w-100"},{default:o(()=>[(h(!0),D(A,null,X(s($),a=>(h(),B(b,{class:"d-flex flex-column",cols:"12",sm:"4",md:"3",lg:"2"},{default:o(()=>[t(ae,{class:E(["task-card d-flex flex-column text-center",{selected:s(r)==a.ID}]),variant:"tonal",onClick:k=>I(a.ID)},{default:o(()=>[t(le,null,{default:o(()=>[t(te,null,{default:o(()=>[x(y(a.name),1)]),_:2},1024),s(v)[a.ID]?(h(),B(se,{key:0},{default:o(()=>[x(y(s(v)[a.ID])+" "+y(s(v)[a.ID]>1?"People":"Person")+" working ",1)]),_:2},1024)):N("",!0)]),_:2},1024),t(oe,null,{default:o(()=>[x(y(a.description),1)]),_:2},1024)]),_:2},1032,["class","onClick"])]),_:2},1024))),256)),t(b,{cols:"12"},{default:o(()=>[t(re,{class:E(["bigbutton",{selected:s(r)==-1}]),variant:"tonal",onClick:e[3]||(e[3]=a=>I(-1))},{default:o(()=>e[7]||(e[7]=[x(" Stop Tracking Time ")])),_:1},8,["class"])]),_:1})]),_:1})]),_:1}),s(r)?(h(),D("div",ce,[t(K,{id:"anum",ref_key:"anum",ref:O,"prepend-icon":s(i),modelValue:s(c),"onUpdate:modelValue":e[4]||(e[4]=a=>V(c)?c.value=a:null),onInput:q,onKeyup:F(U,["enter"]),onKeydown:e[5]||(e[5]=F(a=>I(0),["esc"])),hint:"Enter the A# from your student ID",label:s(z),autocomplete:"off"},null,8,["prepend-icon","modelValue","label"])])):N("",!0),t(ne,{modelValue:s(u),"onUpdate:modelValue":e[6]||(e[6]=a=>V(u)?u.value=a:null),timeout:"2000",location:"top",color:s(d)},{default:o(()=>[x(y(s(f)),1)]),_:1},8,["modelValue","color"])],64))}});export{ge as default};
